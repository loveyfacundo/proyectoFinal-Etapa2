{% load static %}
<header>
  <div class="header-bar">
    <h1 class="header-title">TodoDeporte</h1>

    {# Botones para móvil - tema y menú hamburguesa #}
    <div class="mobile-actions">
      <button
        class="theme-toggle mobile-theme-toggle"
        aria-label="Cambiar tema"
        title="Cambiar tema"
      >
        <svg class="icon icon-md theme-icon" aria-hidden="true">
          <use href="{% static 'img/icons.svg' %}#sun"></use>
        </svg>
      </button>

      <button
        class="mobile-menu-toggle"
        aria-label="Abrir menú"
        aria-expanded="false"
      >
        <svg class="icon icon-md menu-icon" aria-hidden="true">
          <use href="{% static 'img/icons.svg' %}#menu"></use>
        </svg>
      </button>
    </div>

    <nav class="nav" aria-label="Principal">
      <ul class="nav-links">
        <li class="nav-link">
          <a
            href="{% url 'index' %}"
            class="{% if request.resolver_match.url_name == 'index' and not categoria_seleccionada %}active{% endif %}"
            >Inicio</a
          >
        </li>
        <li class="nav-link dropdown">
          <button
            class="dropdown-toggle"
            type="button"
            aria-haspopup="true"
            aria-expanded="false"
          >
            Deportes
            <svg class="icon icon-sm" aria-hidden="true">
              <use href="{% static 'img/icons.svg' %}#chevron-down"></use>
            </svg>
          </button>
          <ul class="dropdown-menu" aria-label="Categorías">
            {% for cat in categorias_globales %}
            <li>
              <a href="{% url 'listar_por_categoria' cat.id %}">
                {{ cat.nombre }}
              </a>
            </li>
            {% empty %}
            <li><a href="#">Sin categorías</a></li>
            {% endfor %}
          </ul>
        </li>
        <li class="nav-link">
          <a
            href="{% url 'about' %}"
            class="{% if request.resolver_match.url_name == 'about' %}active{% endif %}"
            >Acerca de</a
          >
        </li>
        <li class="nav-link">
          <a
            href="{% url 'contact' %}"
            class="{% if request.resolver_match.url_name == 'contact' %}active{% endif %}"
            >Contacto</a
          >
        </li>
      </ul>
    </nav>

    {# Menú móvil desplegable #}
    <div class="mobile-menu" aria-label="Menú de navegación móvil">
      <div class="mobile-menu-content">
        <ul class="mobile-nav-list">
          <li class="mobile-nav-item">
            <a href="{% url 'index' %}" class="mobile-nav-link">
              <svg class="icon icon-sm" aria-hidden="true">
                <use href="{% static 'img/icons.svg' %}#home"></use>
              </svg>
              <span>Inicio</span>
            </a>
          </li>

          <li class="mobile-nav-item mobile-dropdown">
            <button
              class="mobile-nav-link mobile-dropdown-toggle"
              type="button"
            >
              <svg class="icon icon-sm" aria-hidden="true">
                <use href="{% static 'img/icons.svg' %}#trophy"></use>
              </svg>
              <span>Deportes</span>
              <svg class="icon icon-xs chevron" aria-hidden="true">
                <use href="{% static 'img/icons.svg' %}#chevron-down"></use>
              </svg>
            </button>
            <ul class="mobile-submenu">
              {% for cat in categorias_globales %}
              <li>
                <a
                  href="{% url 'listar_por_categoria' cat.id %}"
                  class="mobile-submenu-link"
                >
                  {{ cat.nombre }}
                </a>
              </li>
              {% empty %}
              <li>
                <a href="#" class="mobile-submenu-link">Sin categorías</a>
              </li>
              {% endfor %}
            </ul>
          </li>

          <li class="mobile-nav-item">
            <a href="{% url 'about' %}" class="mobile-nav-link">
              <svg class="icon icon-sm" aria-hidden="true">
                <use href="{% static 'img/icons.svg' %}#info"></use>
              </svg>
              <span>Acerca de</span>
            </a>
          </li>

          <li class="mobile-nav-item">
            <a href="{% url 'contact' %}" class="mobile-nav-link">
              <svg class="icon icon-sm" aria-hidden="true">
                <use href="{% static 'img/icons.svg' %}#mail"></use>
              </svg>
              <span>Contacto</span>
            </a>
          </li>

          <li class="mobile-nav-divider"></li>

          {% if user.is_authenticated %}
            {% if user.is_superuser or user.perfil.rol == 'colaborador' or user.perfil.rol == 'administrador' %}
            <li class="mobile-nav-item">
              <a href="{% url 'crear_articulo' %}" class="mobile-nav-link">
                <svg class="icon icon-sm" aria-hidden="true">
                  <use href="{% static 'img/icons.svg' %}#plus"></use>
                </svg>
                <span>Crear Artículo</span>
              </a>
            </li>
            {% endif %}
            
            {% if user.is_superuser or user.perfil.rol == 'administrador' %}
          <li class="mobile-nav-item">
            <a href="{% url 'gestion_usuarios' %}" class="mobile-nav-link">
              <svg class="icon icon-sm" aria-hidden="true">
                <use href="{% static 'img/icons.svg' %}#user"></use>
              </svg>
              <span>Gestionar Usuarios</span>
            </a>
          </li>
          <li class="mobile-nav-item">
            <a href="{% url 'gestion_categorias' %}" class="mobile-nav-link">
              <svg class="icon icon-sm" aria-hidden="true">
                <use href="{% static 'img/icons.svg' %}#tag"></use>
              </svg>
              <span>Gestionar Categorías</span>
            </a>
          </li>
          {% endif %}

          <li class="mobile-nav-item">
            <a href="{% url 'editar_perfil' %}" class="mobile-nav-link">
              <svg class="icon icon-sm" aria-hidden="true">
                <use href="{% static 'img/icons.svg' %}#user"></use>
              </svg>
              <span>Mi Perfil</span>
            </a>
          </li>

          <li class="mobile-nav-item">
            <form action="{% url 'logout' %}" method="post" style="width: 100%">
              {% csrf_token %}
              <button type="submit" class="mobile-nav-link mobile-logout">
                <svg class="icon icon-sm" aria-hidden="true">
                  <use href="{% static 'img/icons.svg' %}#logout"></use>
                </svg>
                <span>Cerrar Sesión</span>
              </button>
            </form>
          </li>
          {% else %}
          <li class="mobile-nav-item">
            <a href="{% url 'login' %}" class="mobile-nav-link">
              <svg class="icon icon-sm" aria-hidden="true">
                <use href="{% static 'img/icons.svg' %}#login"></use>
              </svg>
              <span>Iniciar Sesión</span>
            </a>
          </li>
          <li class="mobile-nav-item">
            <a href="{% url 'registro' %}" class="mobile-nav-link">
              <svg class="icon icon-sm" aria-hidden="true">
                <use href="{% static 'img/icons.svg' %}#user"></use>
              </svg>
              <span>Registrarse</span>
            </a>
          </li>
          {% endif %}
        </ul>
      </div>
    </div>

    {# Contenedor para botones de tema y perfil #}
    <div class="header-left-elements" style="display: flex; align-items: center;">
      {# Botón de cambio de tema - visible en desktop #}
      <button
        class="theme-toggle"
        aria-label="Cambiar tema"
        title="Cambiar tema"
      >
        <svg class="icon icon-md theme-icon" aria-hidden="true">
          <use href="{% static 'img/icons.svg' %}#sun"></use>
        </svg>
      </button>

      <div class="profile-menu">
      {# --- Botón de Perfil con Menú Desplegable --- #}
      <button
        class="profile-button profile-toggle"
        aria-label="Menú de usuario"
        aria-haspopup="true"
        aria-expanded="false"
      >
        <div class="profile-avatar">
          <svg class="icon icon-md" aria-hidden="true">
            <use href="{% static 'img/icons.svg' %}#user"></use>
          </svg>
        </div>
        <span class="profile-username"
          >{% if user.is_authenticated %}{{ user.username }}{% else %}Iniciar
          Sesión{% endif %}</span
        >
      </button>

      <div class="profile-dropdown" aria-label="Opciones de usuario">
        {% if user.is_authenticated %}
        <div class="profile-menu-logged">
          {% if user.is_superuser or user.perfil.rol == 'colaborador' or user.perfil.rol == 'administrador' %}
          <a href="{% url 'crear_articulo' %}" class="profile-item">
            <img
              src="{% static 'img/plus_add_insert_icon_183799.svg' %}"
              alt="Crear"
              class="menu-icon-svg"
            />
            <span>Crear Artículo</span>
          </a>
          {% endif %}
          
          {% if user.is_superuser or user.perfil.rol == 'administrador' %}
          <a href="{% url 'gestion_usuarios' %}" class="profile-item">
            <img
              src="{% static 'img/user_icon_183752.svg' %}"
              alt="Usuarios"
              class="menu-icon-svg"
            />
            <span>Gestionar Usuarios</span>
          </a>
          <a href="{% url 'gestion_categorias' %}" class="profile-item">
            <img
              src="{% static 'img/category_icon_183800.svg' %}"
              alt="Categorías"
              class="menu-icon-svg"
            />
            <span>Gestionar Categorías</span>
          </a>
          {% endif %}

          <a href="{% url 'editar_perfil' %}" class="profile-item">
            <img
              src="{% static 'img/profile_icon_183761.svg' %}"
              alt="Perfil"
              class="menu-icon-svg"
            />
            <span>Mi Perfil</span>
          </a>

          <form
            action="{% url 'logout' %}"
            method="post"
            style="display: inline"
          >
            {% csrf_token %}
            <button
              type="submit"
              class="profile-item profile-item-logout"
              style="
                width: 100%;
                border: none;
                background: none;
                cursor: pointer;
                text-align: left;
                font-size: 1rem;
              "
            >
              <svg class="icon icon-sm" aria-hidden="true">
                <use href="{% static 'img/icons.svg' %}#logout"></use>
              </svg>
              <span>Cerrar Sesión</span>
            </button>
          </form>
        </div>
        {% else %}
        <div class="profile-menu-guest">
          <a href="{% url 'login' %}" class="profile-item">
            <svg class="icon icon-sm" aria-hidden="true">
              <use href="{% static 'img/icons.svg' %}#login"></use>
            </svg>
            <span>Iniciar Sesión</span>
          </a>
          <a href="{% url 'registro' %}" class="profile-item">
            <svg class="icon icon-sm" aria-hidden="true">
              <use href="{% static 'img/icons.svg' %}#user"></use>
            </svg>
            <span>Registrarse</span>
          </a>
        </div>
        {% endif %}
      </div>
      </div>
    </div>
  </div>
</header>
