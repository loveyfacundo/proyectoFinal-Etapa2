{% extends 'base.html' %}

{% block content %}
    {# 1. Insertamos el Carrusel #}
    {% include 'components/hero_carrusel.html' %}

    <section class="home-grid">
        <div class="home-column">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 10px;">
                
                <h2 style="margin: 0;">
                    {% if categoria_seleccionada %}
                        {{ categoria_seleccionada.nombre }}
                    {% else %}
                        Últimas Noticias
                    {% endif %}
                </h2>
                
                <form method="get" style="display: flex; align-items: center;">
                    <label for="orden" style="margin-right: 8px; font-size: 0.9rem; color: var(--footer-text); font-weight: 500;">
                        Ordenar por:
                    </label>
                    <select name="orden" id="orden" onchange="this.form.submit()" 
                            style="padding: 6px 10px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); cursor: pointer; font-size: 0.9rem;">
                        <option value="reciente" {% if orden_actual == 'reciente' %}selected{% endif %}>Más recientes</option>
                        <option value="antigua" {% if orden_actual == 'antigua' %}selected{% endif %}>Más antiguas</option>
                        <option value="alpha_asc" {% if orden_actual == 'alpha_asc' %}selected{% endif %}>A - Z</option>
                        <option value="alpha_desc" {% if orden_actual == 'alpha_desc' %}selected{% endif %}>Z - A</option>
                    </select>
                </form>

            </div>

            <ul class="news-list">
                {# 2. Iteramos las noticias usando el componente Card #}
                {% for noticia in noticias %}
                    {% include 'components/card_articulo.html' with articulo=noticia %}
                {% empty %}
                    <div style="padding: 2rem; text-align: center; color: var(--footer-text); background: var(--news-thumb-bg); border-radius: 8px;">
                        <p>No se encontraron noticias con este filtro.</p>
                    </div>
                {% endfor %}
            </ul>
        </div>

        {# Barra lateral de categorías #}
        <aside class="home-column">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                <h2 style="margin: 0;">Categorías Populares</h2>
                {% if categoria_seleccionada %}
                    <a href="{% url 'index' %}" style="font-size: 0.85rem; color: var(--link-color); text-decoration: none; font-weight: 600;">
                        Ver todas
                    </a>
                {% endif %}
            </div>
            <ul class="category-list">
                {% for cat in categorias %}
                    <li class="{% if categoria_seleccionada.id == cat.id %}active{% endif %}" data-position="{{ forloop.counter }}">
                        <a href="{% url 'listar_por_categoria' cat.id %}">
                            <span class="category-name">{{ cat.nombre }}</span>
                            <span class="category-stats">
                                <span class="stat-item stat-articles">{{ cat.total_articulos }} art.</span>
                                <span class="stat-item stat-comments">{{ cat.total_comentarios }} com.</span>
                            </span>
                        </a>
                    </li>
                {% empty %}
                    <li style="padding: 1rem; text-align: center; color: var(--footer-text);">
                        No hay categorías disponibles
                    </li>
                {% endfor %}
            </ul>
        </aside>
    </section>
{% endblock %}