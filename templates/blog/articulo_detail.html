{% extends 'base.html' %}
{% load static %}

{% block title %}{{ articulo.titulo }} - TodoDeporte{% endblock %}

{% block content %}
<article class="articulo-detalle" style="max-width: 800px; margin: 0 auto;">
    
    {# Cabecera del artículo #}
    <header style="margin-bottom: 2rem;">
        <span class="badge" style="background: var(--header-bg); color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 0.9rem;">
            {{ articulo.categoria.nombre }}
        </span>
        <h1 style="margin-top: 10px; font-size: 2.5rem; color: var(--title-color);">{{ articulo.titulo }}</h1>

        {% if user.is_superuser or user.perfil.rol == 'colaborador' %}
            <div style="margin-top: 10px;">
                <a href="{% url 'editar_articulo' articulo.id %}" style="margin-right: 15px; color: var(--link-color); font-weight: bold;">Editar Artículo</a>
                <a href="{% url 'eliminar_articulo' articulo.id %}" style="color: #dc3545; font-weight: bold;">Eliminar Artículo</a>
            </div>
        {% endif %}

        <div class="meta" style="color: var(--footer-text); margin-top: 10px;">
            Por <strong>{{ articulo.autor.first_name|default:articulo.autor.username }}</strong> 
            | {{ articulo.fecha_creacion|date:"d de F de Y" }}
        </div>
    </header>

    {# Imagen Destacada #}
    {% if articulo.imagen_destacada %}
        <figure style="margin-bottom: 2rem;">
            <img src="{{ articulo.imagen_destacada.url }}" alt="{{ articulo.titulo }}" style="width: 100%; border-radius: 8px; max-height: 400px; object-fit: cover;">
        </figure>
    {% endif %}

    {# Contenido Principal #}
    <div class="contenido" style="line-height: 1.8; font-size: 1.1rem; color: var(--text-color);">
        {# linebreaks convierte los saltos de línea del admin en párrafos HTML <p> #}
        {{ articulo.contenido|linebreaks }}
    </div>

    <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 3rem 0;">

    {# Sección de Comentarios (Placeholder por ahora) #}
    <section style="margin-top: 3rem;">
        <h3 style="margin-bottom: 1.5rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">
            Comentarios ({{ comentarios.count }})
        </h3>

        {# 1. Formulario de Nuevo Comentario #}
        {% if user.is_authenticated %}
            <div style="background: var(--bg-color); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                <h4 style="margin-bottom: 1rem;">Deja tu opinión</h4>
                <form method="post">
                    {% csrf_token %}
                    {{ form.contenido }}
                    <button type="submit" style="margin-top: 10px; padding: 8px 16px; background: var(--header-bg); color: white; border: none; border-radius: 4px; cursor: pointer;">
                        Publicar Comentario
                    </button>
                </form>
            </div>
        {% else %}
            <p style="margin-bottom: 2rem; padding: 1rem; background: #fff3cd; border: 1px solid #ffeeba; border-radius: 6px; color: #856404;">
                Debes <a href="{% url 'login' %}?next={{ request.path }}" style="font-weight: bold; color: inherit;">iniciar sesión</a> para comentar.
            </p>
        {% endif %}

        {# 2. Lista de Comentarios #}
        {% if comentarios %}
            <ul style="list-style: none; padding: 0;">
                {% for c in comentarios %}
                    <li style="margin-bottom: 1.5rem; padding: 1.5rem; background: var(--card-bg); border-radius: 8px; box-shadow: 0 2px 4px var(--card-shadow);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <div>
                                <strong style="font-size: 1.1em;">{{ c.autor.username }}</strong>
                                <span style="font-size: 0.85em; color: var(--footer-text); margin-left: 10px;">
                                    {{ c.fecha_creacion|date:"d M Y, H:i" }}
                                </span>
                            </div>
                            
                            {# Botones de Acción (Solo para el dueño) #}
                            {% if user == c.autor or user.is_superuser or user.perfil.rol == 'colaborador' %}
                                <div style="font-size: 0.9em;">
                                    <a href="{% url 'editar_comentario' c.id %}" style="color: #007bff; text-decoration: none; margin-right: 10px;">
                                        {% if user == c.autor %}Editar{% else %}Moderar{% endif %}
                                    </a>
                                    <a href="{% url 'eliminar_comentario' c.id %}" style="color: #dc3545; text-decoration: none;">
                                        Eliminar
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                        
                        <div style="line-height: 1.6;">
                            {{ c.contenido|linebreaks }}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p style="color: var(--footer-text);">No hay comentarios aún. ¡Sé el primero en opinar!</p>
        {% endif %}
    </section>

    {# Botón Volver #}
    <div style="margin-top: 2rem;">
        <a href="{% url 'index' %}" style="text-decoration: none; color: var(--link-color); font-weight: bold;">← Volver al inicio</a>
    </div>

</article>
{% endblock %}